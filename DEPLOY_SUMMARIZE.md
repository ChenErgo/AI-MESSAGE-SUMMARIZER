# 部署 Summarize 云函数指南

## 问题描述

从日志可以看出，当前部署的云函数还是旧版本，返回了 `data: null` 和 `needs_ai: true`，导致结果页面显示空白。

## 解决方案

需要在微信开发者工具中重新部署 summarize 云函数。

## 部署步骤

1. **打开微信开发者工具**
   - 确保已经打开了 `ai-message-summarizer` 项目

2. **找到云函数目录**
   - 在左侧文件树中找到 `cloudfunctions/summarize` 目录

3. **上传并部署云函数**
   - 右键点击 `cloudfunctions/summarize` 目录
   - 选择 **"上传并部署：云端安装依赖"**
   - 等待上传和部署完成（可能需要 1-2 分钟）

4. **验证部署**
   - 部署完成后，云函数图标会变成绿色
   - 可以在云开发控制台的云函数页面看到部署记录

5. **测试功能**
   - 在小程序中重新测试消息总结功能
   - 应该能够正常返回总结结果，不再显示空白页面

## 已完成的修改

1. ✅ 更新了 `package.json`，添加了正确的依赖版本
2. ✅ 重构了 `index.js`，使用官方的 cloudbase js-sdk
3. ✅ 删除了不再需要的 `lib` 目录及相关文件
4. ✅ 简化了小程序端代码
5. ✅ 安装了云函数依赖

## 技术细节

新的云函数实现：
- 使用 `@cloudbase/js-sdk` 和 `@cloudbase/adapter-node`
- 在云函数内部直接调用 AI Agent
- 不再需要客户端调用 AI
- 简化了代码逻辑，提高了可维护性

## 注意事项

- 确保云开发环境 ID 正确配置
- 确保云开发环境已开通 AI Agent 服务
- 确保云函数部署成功后再测试